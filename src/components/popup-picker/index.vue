<template>
  <cell :title="title" primary="content" is-link :inline-desc="inlineDesc" @click="onClick">
    <span class="vux-popup-picker-value" style="display: none">{{value}}</span>
    <span class="vux-popup-picker-value" v-else="showName && value.length">{{name}}</span>
    <span v-if="!value.length && placeholder" v-html="placeholder"></span>
  </cell>
  <popup :show.sync="show" class="vux-popup-picker" :id="'vux-popup-picker-'+uuid" @on-hide="onPopupHide" @on-show="$emit('on-show')">
    <div class="vux-popup-picker-container">
      <div class="vux-popup-picker-header">
        <flexbox>
          <flexbox-item style="text-align:left;padding-left:.15rem;line-height:.44rem;" @click="onHide(false)">取消</flexbox-item>
          <flexbox-item style="text-align:right;padding-right:.15rem;line-height:44px;" @click="onHide(true)">完成</flexbox-item>
        </flexbox>
      </div>
      <picker :data="data" :value.sync="tempValue" :columns="columns"  @on-change="onPickerChange"></picker>
    </div>
  </popup>
</template>

<script>
import Picker from '../picker'
import Cell from '../cell'
import Popup from '../popup'
import Flexbox from '../flexbox'
import FlexboxItem from '../flexbox-item'
import array2string from '../../filters/array2String'
import value2name from '../../filters/value2name'
import uuidMixin from '../../libs/mixin_uuid'

const getObject = function (obj) {
  return JSON.parse(JSON.stringify(obj))
}

export default {
  mixins: [uuidMixin],
  components: {
    Picker,
    Cell,
    Popup,
    Flexbox,
    FlexboxItem
  },
  filters: {
    array2string,
    value2name
  },
  props: {
    title: String,
    data: {
      type: Array,
      default () {
        return []
      }
    },
    placeholder: String,
    columns: {
      type: Number,
      default: 0
    },
    value: {
      type: Array,
      default () {
        return []
      }
    },
    showName: Boolean,
    inlineDesc: String
  },
  methods: {
    onClick () {
      this.show = true
    },
    onHide (type) {
      this.show = false
      if (type) {
        this.closeType = true
        this.value = getObject(this.tempValue)
      }
      if (!type) {
        this.closeType = false
        this.tempValue = getObject(this.value)
      }
    },
    onPopupHide (val) {
      this.tempValue = getObject(this.value)
      this.$emit('on-hide', this.closeType)
    },
    onPickerChange (val,name) {
      this.value = val
      this.name = name;
      console.log(name)
    }
  },
  watch: {
    value (val) {
    }
  },
  data () {
    return {
      show: false,
      tempValue: getObject(this.value),
      closeType: false,
      name:[]
    }
  }
}
</script>

<style>
.vux-popup-picker {
  border-top: .01rem solid #04BE02;
}
.vux-popup-picker-header {
  height: .44rem;
  color: #04BE02;
}
.vux-popup-picker-value {
  display: inline-block;
  float: left;
}
</style>
